---
title: unix环境高级编程17-高级进程间通信
date: 2023-04-10 17:23:39
tags: linux 编程
category: unix环境高级编程
---

## UNIX 域套接字

UNIX 域套接字形式的 IPC 可以在同一计算机系统上运行的两个进程之间传送打开文件描述符。服务进程可以使它们的打开文件描述符与指定的名字相关联，同一系统上运行的客户进程可以使用这些名字与服务器进程汇聚。

UNIX 域套接字用于在同一台计算机上运行的进程之间的通信。虽然因特网域套接字可用于同一目的，但 UNIX 域套接字的效率更高。UNIX 域套接字仅仅复制数据，它们并不执行协议处理，不需要添加或删除网络报头，无需计算校验和，不要产生顺序号，无需发送确认报文。

UNIX 域套接字提供流和数据报两种接口。UNIX 域数据报服务是可靠的，既不会丢失报文也不会传递出错。UNIX 域套接字就像是套接字和管道的混合。可以使用它们面向网络的域套接字接口或者使用 socketpair 函数来创建一对无命名的、相互连接的 UNIX 域套接字。

```c
#include <sys/socket.h>
int socketpair(int domain, int type, int protocol, int sockfd[2]);
```

返回值：

- 若成功，返回 0；
- 若出错，返回-1。

虽然接口足够通用，允许 socketpair 用于其他域，但一般来说操作系统仅对 UNIX 域提供支持。

一对相互连接的 UNIX 域套接字可以起到全双工管道的作用：两端对读和写开放（见图 17-1）。我们将其称为 fd 管道（fd-pipe），以便与普通的半双工管道区分开来。

例子，创建一个全双工管道。

```c

```

例子，使用 UNIX 域套接字轮询 XSI 消息队列

## 唯一连接

服务器进程可以使用标准 bind、listen 和 accept 函数，为客户进程安排一个唯一 UNIX 域连接。客户进程使用 connect 与服务器进程联系。在服务器进程接受了 connect 请求后，在服务器进程和客户进程之间就存在了唯一连接。这种风格的操作与我们在图 16-16 和图 16-17 中所示的对因特网域套接字的操作相同。

图 17-6 展示了客户进程和服务器进程存在连接之前二者的情形。服务器端把它的套接字绑定到 sockaddr_un 的地址并监听新的连接请求。图 17-7 展示了在服务器端接受客户端连接请求后，客户端和服务器端之间建立的唯一的连接。

现在，我们将开发 3 个函数，使用这些函数可以在运行于同一台计算机上的两个无关进程之间创建唯一连接。这些函数模仿了在 16.4 节中讨论过的面向连接的套接字函数。这里，我们将 UNIX 域套接字应用于底层通信机制。

## 传送文件描述符

## open 服务器进程第 1 版

## open 服务器进程第 2 版
